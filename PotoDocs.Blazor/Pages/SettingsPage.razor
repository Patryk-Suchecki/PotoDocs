@attribute [Authorize]
@page "/ustawienia"

<MudBreadcrumbs Items="_items"></MudBreadcrumbs>
<PageTitle>Ustawienia</PageTitle>
<MudText Typo="Typo.h4" GutterBottom="true" Color="Color.Primary">Ustawienia</MudText>

@if (IsLoading)
{
    <MudGrid Justify="Justify.Center" Class="pa-10">
        <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
    </MudGrid>
}
else
{
    <MudText Typo="Typo.h6">Profil</MudText>
    <MudText Align="Align.Left"><b>Użytkownik:</b> @UserDto.FirstAndLastName</MudText>
    <MudText Align="Align.Left"><b>E-mail:</b> @UserDto.Email</MudText>
    <MudText Align="Align.Left"><b>Rola:</b> @UserDto.Role</MudText>

    <MudText Typo="Typo.h6">Zmiana hasła</MudText>

    <MudForm @ref="form" Model="@ChangePasswordDto" Validation="@(passwordValidator.ValidateValue)" ValidationDelay="0">
        <MudTextField @bind-Value="ChangePasswordDto.OldPassword"
                      Label="Stare hasło"
                      Variant="Variant.Outlined"
                      InputType="@_passwordInputType"
                      Adornment="Adornment.End"
                      AdornmentIcon="@_passwordInputIcon"
                      OnAdornmentClick="TogglePasswordVisibility"
                      AdornmentAriaLabel="Pokaż hasło"
                      For="@(() => ChangePasswordDto.OldPassword)"
                      Immediate="true" />
        <MudTextField @bind-Value="ChangePasswordDto.NewPassword"
                      Label="Nowe hasło"
                      Variant="Variant.Outlined"
                      InputType="@_passwordInputType"
                      Adornment="Adornment.End"
                      AdornmentIcon="@_passwordInputIcon"
                      OnAdornmentClick="TogglePasswordVisibility"
                      AdornmentAriaLabel="Pokaż hasło"
                      For="@(() => ChangePasswordDto.NewPassword)"
                      Immediate="true" />
        <MudTextField @bind-Value="_confirmPassword"
                      Label="Powtórz nowe hasło"
                      Variant="Variant.Outlined"
                      InputType="@_passwordInputType"
                      Adornment="Adornment.End"
                      AdornmentIcon="@_passwordInputIcon"
                      OnAdornmentClick="TogglePasswordVisibility"
                      AdornmentAriaLabel="Pokaż hasło"
                      Validation="@(new Func<string, IEnumerable<string>>(ValidateConfirmPassword))"
                      Immediate="true" />

        <MudButton Variant="Variant.Filled" ButtonType="ButtonType.Button" OnClick="SubmitAsync" Color="Color.Primary" Disabled="@IsLoading">Zmień hasło</MudButton>
    </MudForm>
}