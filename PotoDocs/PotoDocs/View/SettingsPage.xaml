<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:PotoDocs.ViewModel"
             x:Class="PotoDocs.View.SettingsPage"
             Title="Ustawienia"
             x:DataType="vm:SettingsViewModel">

    <Grid RowDefinitions="Auto,Auto,*">

        <Label Grid.Row="0"
           Text="Ustawienia"
           FontSize="24"
           FontFamily="RobotoBold"
           TextColor="#640000"
           HorizontalOptions="Start"
           VerticalOptions="Start"
           Margin="20,10,0,0" />
        
        <VerticalStackLayout Padding="20" Spacing="10" Grid.Row="1">
            <!-- Odświeżanie -->
            <!-- Sekcja Profil -->
            <Frame Padding="20" BorderColor="Black">
                <RefreshView Command="{Binding GetUserCommand}" IsRefreshing="{Binding IsRefreshing}" Grid.Row="1">
                    <VerticalStackLayout Spacing="20">
                        <Label Text="Profil" FontSize="18" FontAttributes="Bold" />

                        <HorizontalStackLayout Spacing="10">
                            <Label Text="Imię:" FontAttributes="Bold" VerticalOptions="Center" />
                            <Label Text="{Binding UserDto.FirstName}" VerticalOptions="Center" />
                        </HorizontalStackLayout>

                        <HorizontalStackLayout Spacing="10">
                            <Label Text="Nazwisko:" FontAttributes="Bold" VerticalOptions="Center" />
                            <Label Text="{Binding UserDto.LastName}" VerticalOptions="Center" />
                        </HorizontalStackLayout>

                        <HorizontalStackLayout Spacing="10">
                            <Label Text="E-mail:" FontAttributes="Bold" VerticalOptions="Center" />
                            <Label Text="{Binding UserDto.Email}" VerticalOptions="Center" />
                        </HorizontalStackLayout>

                        <HorizontalStackLayout Spacing="10">
                            <Label Text="Rola:" FontAttributes="Bold" VerticalOptions="Center" />
                            <Label Text="{Binding UserDto.Role}" VerticalOptions="Center" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </RefreshView>
            </Frame>

            <!-- Sekcja zmiany hasła -->
            <VerticalStackLayout Spacing="20">
                <Label Text="Zmiana hasła"
                       FontSize="18"
                       FontAttributes="Bold"
                       HorizontalOptions="Start" />

                <!-- Stare hasło -->
                <Entry Text="{Binding ChangePasswordDto.OldPassword}" Placeholder="Wprowadź stare hasło" IsPassword="True"/>
                <Label Text="{Binding ValidationErrors[OldPassword]}" TextColor="Red" FontSize="12" />

                <!-- Nowe hasło -->
                <Entry Text="{Binding ChangePasswordDto.NewPassword}" Placeholder="Wprowadź nowe hasło"  IsPassword="True"/>
                <Label Text="{Binding ValidationErrors[NewPassword]}" TextColor="Red" FontSize="12" />

                <Button Text="Zmień hasło"
                        FontSize="16"
                        CornerRadius="10"
                        Padding="10"
                        Command="{Binding ChangePasswordCommand}" />
            </VerticalStackLayout>

            <!-- Sekcja Powiadomienia -->
            <VerticalStackLayout Spacing="20">
                <Label Text="Powiadomienia"
                       FontSize="18"
                       FontAttributes="Bold"
                       HorizontalOptions="Start" />

                <!-- Włącz powiadomienia -->
                <HorizontalStackLayout Spacing="10" HorizontalOptions="Start">
                    <Label Text="Włącz powiadomienia aplikacji"
                           FontSize="16"
                           VerticalOptions="Center"/>

                    <Switch IsToggled="{Binding AreNotificationsEnabled}"/>
                </HorizontalStackLayout>
            </VerticalStackLayout>
            <ActivityIndicator Grid.RowSpan="2"
                               Grid.ColumnSpan="2"
                               HorizontalOptions="Fill"
                               IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}"
                               Color="{StaticResource Primary}"
                               VerticalOptions="Center" />
        </VerticalStackLayout>
    </Grid>
</ContentPage>
